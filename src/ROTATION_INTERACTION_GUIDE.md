# Lofi FM 旋转交互功能指南

## 功能概述

本项目成功集成了模型旋转功能和按钮交互功能，实现了以下特性：

### 1. 智能交互优先级
- **按钮交互优先**：当射线检测到按钮时，优先处理按钮点击事件
- **旋转交互次优**：当射线检测到非按钮的可旋转区域时，启动模型旋转功能
- **防冲突设计**：确保按钮操作和旋转操作不会相互干扰

### 2. 按钮交互功能
- 播放/暂停按钮：点击可切换音乐播放状态
- 按钮动画：包含按下和抬起动画效果
- 视觉反馈：悬停、按下、播放等不同状态的视觉效果
- 防抖机制：防止频繁点击导致的问题

### 3. 模型旋转功能
- **拖拽旋转**：在非按钮区域拖拽可旋转整个模型
- **平滑旋转**：支持X轴和Y轴旋转，带有合理的角度限制
- **精确控制**：旋转速度和灵敏度经过优化调整

## 技术实现

### 核心组件

1. **xrControl 对象扩展**
   ```javascript
   const xrControl = {
     // 原有属性...
     selectedModel: null,     // 当前选中的模型
     isDragging: false,       // 是否正在拖拽
     controllerPrev: new THREE.Vector3(), // 上一帧控制器位置
     rotationSpeed: 3000.0    // 旋转速度
   };
   ```

2. **射线检测策略**
   - 按钮区域：保持 `userData.isButton = true`
   - 可旋转区域：设置 `userData.isRotatable = true`
   - 优先级：按钮 > 旋转 > 无操作

3. **事件处理流程**
   ```
   onSelectStart -> 检测交集 -> 判断类型 -> 执行对应操作
   ├── 按钮区域 -> 按钮交互逻辑
   └── 可旋转区域 -> 启动旋转模式
   
   handleControllerInteraction -> 持续处理拖拽旋转
   
   onSelectEnd -> 结束所有交互状态
   ```

### 关键函数

1. **getControllerPosition()** - 获取控制器3D位置
2. **applyCameraRelativeRotation()** - 应用相机相对旋转
3. **智能目标选择** - 自动选择最合适的旋转目标（模型容器）

## 使用方法

### 在XR环境中
1. 启动AR会话
2. 将控制器指向播放按钮进行音乐控制
3. 将控制器指向模型其他区域并拖拽进行旋转
4. 松开控制器结束当前操作

### 交互区域
- **按钮区域**：pause_play 按钮及其子组件
- **旋转区域**：模型的其他所有可见部分
- **无效区域**：空白背景区域

## 优化特性

1. **性能优化**
   - 只在拖拽状态下计算旋转
   - 悬停检测仅在非拖拽状态下进行
   - 合理的旋转速度避免过度计算

2. **用户体验**
   - 清晰的交互反馈
   - 平滑的旋转动画
   - 直观的操作逻辑

3. **稳定性**
   - 完善的错误处理
   - 状态管理机制
   - 资源清理逻辑

## 扩展可能

- 支持多点触控旋转
- 添加缩放功能
- 实现更多按钮交互
- 优化旋转算法
- 添加旋转边界限制

---

*此功能基于 Three.js 和 WebXR 技术实现，兼容支持 WebXR 的现代浏览器和设备。*